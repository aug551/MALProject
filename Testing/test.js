const clientID = "2b8d36cc897656a0b7ec7ccce4c0707c";
const clientSecret = "23f59c115d756619a4a1afc822c3ae94ea9eb942c7c4fb067e10730ed315c1a2";

function generateRandomString(length) {
    var text = "";
    var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";
    for (var i = 0; i < length; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
    }
    return text;
}

function print_new_authorization_url(code_challenge){
    url = "https://myanimelist.net/v1/oauth2/authorize?response_type=code&client_id=" + clientID + "&code_challenge=" + code_challenge ;
    return url;
}

//var currUrl = document.URL;


const codeVerifier = code_challenge = generateRandomString(128);

//var auth_code = currUrl.split("code=")[1];

// console.log(auth_code);

var XMLHttpRequest = require("xmlhttprequest").XMLHttpRequest;
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.myanimelist.net/v2/users/@me');
xhr.setRequestHeader('Authorization', 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjI2MjEzODg2OTFlODE2Y2EwNTI2NDU4NjQwYTQ3ZGM1YzFmNTE2YjlhMDY2NGQ1Yjc0ZGVhNmY2ZDA3YzFmMDE0NTAyMmY3NTRkM2NjOWY2In0.eyJhdWQiOiIyYjhkMzZjYzg5NzY1NmEwYjdlYzdjY2NlNGMwNzA3YyIsImp0aSI6IjI2MjEzODg2OTFlODE2Y2EwNTI2NDU4NjQwYTQ3ZGM1YzFmNTE2YjlhMDY2NGQ1Yjc0ZGVhNmY2ZDA3YzFmMDE0NTAyMmY3NTRkM2NjOWY2IiwiaWF0IjoxNjE0MTEzNDMzLCJuYmYiOjE2MTQxMTM0MzMsImV4cCI6MTYxNjUyOTAzMywic3ViIjoiODQyOTQ3OSIsInNjb3BlcyI6W119.Y-YsBX6ZShBILQwioh4TcYV2zCahPxKR9NBB9FR_orZJKEyoTeB4Yp1t9bxxYqqC7hPwmHWs_BqZnkoVmgkdriPo7P2Zc10oFDE8dlfp9M5y5jrKu5K4XyiJGAzIbkkxM8arYDtWytsTVxaXjvqYKN_ummsl5D6dHHlpK7jjSD4CJUq6FMooS_MZhJORsJBTzqkVCUTOvtFOh0PFydIosVAwSr6S5mjUlgVcrKTrRTue9NE5mI5D_o6NoB3BkVY7RSfDj8ScOoeqMTNfNFdDKzhlX0epm37049hAAO9e7JxmaW__G74IuKahKLVBPMifDw9JWCtrlhyPEAxzMH7kWw","refresh_token":"def502003e2ce64689b3b60d7563b338072243c8595670bb784f3141209512c291dc6c2ab93f6d3a29b8fbc20bf77c5cdfaf1a9f7ae9df2c1a226709317da643ad29b3657d12c5a46610390854a41c0a0cdb3e353f350722fb9be69fb8136078a6d8afc73bbe90e3259668e8baf70b18bec8b6111fb5b387a3ef8ba079e8f006cad9440b52d3b4621019f4c3609bf214879fbc0023f82a6b052e87f5d04275e44351c16bb3ae53407f52e6d2e3888b6691839faf3b13dafbd222e13e012f4ff92022a4729a5f36a4b1e36df9fb27e2f3d63b07ac7b9e8d08c4aa515d8b3773862e297492728b59807de62e299ce71387ed2371afc51f40ebab629388e3d2c53c5385d73dfecd2c7543490cdb6e2b58481a796c34298745145f93df17136207194eeeb1e6d381f9d01cfbab0d4187a06deb9814869c9431709b67c11d262c363f267e773a12c2ded1a3deb2837568d5004ed28bbc92042d49adf34876bcc3d52942bd0c196a8fd4fa1eae34e5946d73eccb3c1daabb2629c1219acccd74bdf63d4138ab522c4ca838');

xhr.onload = function(){
    if(this.status == 200 || this.status == 304){
        var json_response = JSON.parse(this);
        console.log(this.token);
    }
}

xhr.send();



//main


console.log(codeVerifier);

//def50200e407d75975306e319d7043584e4c0d72e3ec7d63fa5591eeef85866aeb756b905a85bdbb94e28311825a79dac51c43b46eccf8b366a96cd596bf4d6239af5e7956923e86c19874022dc30371bf668a10825154a0047ba17f24b43ed5600c01747838c3a5a5b1e6e24689914c60382a6611a749b90f9d8b84374272aeb22afabc20155706358137f3e0e5013fef610ee8912d158058b4fc714b8f4801d5f87fce849543909e3ad80ef08fc497f18bb239fca1a912850c91e76690b64864b8372da6908c72936e40766b926995221fa1ac725c37a769cce9f6d78c95d9654214f00c9266f5b04f406a6c476fc331a683166516bb0bdd7de1d883a1685bcf2b5913224d8332f50d4bc2ad5c8413e917bee5264e2c13ee27d63017d17f0aabb322aee174b3b6786262dc980687c1b614487ae66454b96eacbf3573f66c99e4d2160050bc3a06bcaeae71fc15041d22fd66f2dd95307693d5bf4854c3cace3e461ab330a9f61e6a3362e8affb969e9bc673fc3bca8195054a579a0f4f57f9e4c5a089af62c4fbf55232e65317352e5ad21482571ba086ef02550221a8d04e2d3bc9942b07fd408a2f040da7dc38b78c75a1ad975e8d61885714bd937fc7dd2f4311653e826247557fa8450887c544cc7f127b96c0bb61465a72c995d6a4db1b68404621674a2fc0